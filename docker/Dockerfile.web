FROM node:20-alpine

WORKDIR /app

# Install native dependencies required by vite/esbuild/rollup
RUN apk add --no-cache libc6-compat python3 make g++

# Install dependencies
COPY web/package*.json ./
RUN npm install

# Copy all source files to /app (not /app/src)
COPY web/ ./

EXPOSE 3000
COPY docker/entrypoint-web.sh /usr/local/bin/entrypoint-web
RUN chmod +x /usr/local/bin/entrypoint-web
CMD ["/usr/local/bin/entrypoint-web"]
